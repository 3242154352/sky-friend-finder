<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SKY Friend Finder</title>
    <style>
        body {
            background-image: url('sky.jpg');
            background-size: cover;
            font-family: Arial, sans-serif;
            color: white;
            text-align: center;
            padding: 20px;
        }
        .button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 15px 32px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
        }
        .input {
            padding: 10px;
            margin: 5px;
            font-size: 16px;
        }
        .comment-box {
            margin-top: 20px;
        }
        .comment {
            background-color: #ddd;
            margin: 10px;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="page1">
        <h1>Do you play SKY?</h1>
        <button class="button" onclick="playSky()">Yes</button>
        <button class="button" onclick="goToWebsite()">No</button>
    </div>

    <div id="page2" style="display:none;">
        <h2>What do you want to do with your SKY partner?</h2>
        <button class="button" onclick="selectOption('light fire')">Find a partner to light their fire</button>
        <button class="button" onclick="selectOption('exchange hearts')">Find a partner to exchange hearts</button>
        <button class="button" onclick="selectOption('both')">Both</button>
    </div>

    <div id="page3" style="display:none;">
        <h2>How frequently do you play SKY?</h2>
        <button class="button" onclick="selectFrequency('everyday')">Every day</button>
        <button class="button" onclick="selectFrequency('on weekends and holidays')">Weekends</button>
        <button class="button" onclick="selectFrequency('occasionally')">Occasionally</button>
    </div>

    <div id="page4" style="display:none;">
        <h2>Leave your details!</h2>
        <input class="input" type="text" id="friendCode" placeholder="Your friend code">
        <input class="input" type="text" id="nickname" placeholder="Your nickname">
        <button class="button" onclick="submitDetails()">Submit</button>
    </div>

    <div id="commentsSection" class="comment-box" style="display:none;">
        <h2>Other Comments</h2>
        <div id="commentsList"></div>
    </div>

    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBMmjrMQPE_5idnLV__FOUhR-Ev2yICoqc",
            authDomain: "find-a-skymate.firebaseapp.com",
            projectId: "find-a-skymate",
            storageBucket: "find-a-skymate.firebasestorage.app",
            messagingSenderId: "506883472432",
            appId: "1:506883472432:web:c7891413e6c51b4a5a41f5"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Handle page navigation
        function playSky() {
            document.getElementById("page1").style.display = "none";
            document.getElementById("page2").style.display = "block";
        }

        function goToWebsite() {
            window.location.href = 'https://thatskygame.com'; // Official website
        }

        function selectOption(option) {
            console.log("User chose:", option);
            document.getElementById("page2").style.display = "none";
            document.getElementById("page3").style.display = "block";
        }

        function selectFrequency(frequency) {
            console.log("User plays:", frequency);
            document.getElementById("page3").style.display = "none";
            document.getElementById("page4").style.display = "block";
        }

        // Submit details to Firestore
        async function submitDetails() {
            const friendCode = document.getElementById("friendCode").value;
            const nickname = document.getElementById("nickname").value;

            try {
                // Save to Firestore
                await addDoc(collection(db, "comments"), {
                    nickname: nickname,
                    friendCode: friendCode,
                    timestamp: new Date()
                });

                console.log("Friend Code and Nickname submitted:", friendCode, nickname);
                document.getElementById("page4").style.display = "none";
                document.getElementById("commentsSection").style.display = "block";
                displayComments(); // Display the updated comments
            } catch (error) {
                console.error("Error submitting details:", error);
            }
        }

        // Display comments from Firestore
        async function displayComments() {
            const commentsList = document.getElementById("commentsList");
            commentsList.innerHTML = ''; // Clear previous comments

            const q = query(collection(db, "comments"), orderBy("timestamp", "desc"));
            const querySnapshot = await getDocs(q);
            querySnapshot.forEach((doc) => {
                const commentData = doc.data();
                const commentDiv = document.createElement("div");
                commentDiv.classList.add("comment");
                commentDiv.innerHTML = `<strong>${commentData.nickname}</strong>: Friend Code - ${commentData.friendCode}`;
                commentsList.appendChild(commentDiv);
            });
        }

        // Fetch and display comments when the page loads
        window.onload = function() {
            displayComments();
        };
    </script>
</body>
</html>
